<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<!--  namespace는 패키지 경로를 포함한 전체이름을 가진 구문을 구분하기 위해 필수로 사용해야한다.
     namespace는 인터페이스 바인딩을 가능하게 한다.-->

<!--  namespace는 DAO인터페이스의 경로를 적어줌
이유 : dao인터페이스에 선언된 메소드 이름과 여기 id값을  매핑시켜야 하기 때문 
즉, 작업해야하는 dao인터페이스의 패키지명을 적어줘야한다. --> 


<mapper namespace="com.crescendo.spring.admin.model.dao.projectlistview1.IProjectListView1DAO">

<!--  ProjectListView1  -->


   <resultMap type="ProjectListView1VO" id="projectlistview1ResultSet">
      <id column="APP_NUM" property="appNum"/>
     <!--  <id column="PRJ_NUM" property="prjNum"/> -->
	  <result column="PRJ_NUM" property="prjNum"/>
      <result column="PRJ_TITLE" property="prjTitle"/>
      <result column="PRJ_GOAL" property="prjGoal"/>
      <result column="MA_NUM" property="maNum"/>
      <result column="MA_NAME" property="maName"/>
      <result column="MA_DATE" property="maDate"/>
      <result column="USER_TEL" property="userTel"/>
      <result column="EVA_STANDARD" property="evaStandard"/>
      <result column="EVA_NUM" property="evaNum"/>
      <result column="USER_NUM" property="userNum"/>
   </resultMap>
   

   <!-- 승인대기 목록 리스트 -->
   <select id="projectListView1" resultType="ProjectListView1VO">

	SELECT APP_NUM, PRJ_NUM, PRJ_TITLE, PRJ_GOAL,MA_NUM, MA_NAME, MA_DATE, APP_NUM, EVA_STANDARD,USER_NUM
	FROM VIEW_PRJ_APP
	WHERE EVA_STANDARD != '승인완료'
	GROUP BY APP_NUM, PRJ_NUM, PRJ_TITLE, PRJ_GOAL,MA_NUM, MA_NAME,MA_DATE, APP_NUM, EVA_STANDARD,USER_NUM
   </select>
   
   	 <!-- 심사 대기중  > 심사 완료 --> 
	<update id="passProject" parameterType="ProjectListview1VO">
		UPDATE TBL_APP 
		SET EVA_NUM = 3
		WHERE APP_NUM = #{appNum}
	</update>
	
	 <!-- 심사 대기중  > 심사완료 -> 거절사유 적고 거절페이지로 이동--> 
	<insert id="rejectProject" >
		INSERT INTO TBL_FINAL(FINAL_NUM, APP_NUM, FINAL_STA, FINAL_DATE)
		VALUES(SEQ_FINAL.NEXTVAL, #{appNum},  '거절', SYSDATE)
	</insert> 
	
	<!-- 심사 대기중 > 심사완료 > 진행중인 프로젝트 등록 -->
   <insert id="insertProject" >
		INSERT INTO TBL_FINAL(FINAL_NUM, APP_NUM, FINAL_STA, FINAL_DATE)
		VALUES(SEQ_FINAL.NEXTVAL, #{appNum},  '승인', SYSDATE)
	</insert> 
</mapper>   