<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<!--  namespace는 패키지 경로를 포함한 전체이름을 가진 구문을 구분하기 위해 필수로 사용해야한다.
	  namespace는 인터페이스 바인딩을 가능하게 한다.
	  
	  
	  
 -->
 
<!--  namespace는 DAO인터페이스의 경로를 적어줌
 이유 : dao인터페이스에 선언된 메소드 이름과 여기 id값을  매핑시켜야 하기 때문 
 즉, 작업해야하는 dao인터페이스의 패키지명을 적어줘야한다. --> 
 
<mapper namespace="com.crescendo.spring.admin.model.dao.payback.IPayBackDAO">



	<resultMap type="PayBackVO" id="paybackResultSet">
		<id column="PB_NUM" property="pbNum"/>
		<result column="PRJ_TITLE" property="prjTitle"/>
		<result column="USER_NAME" property="userName"/>
		<result column="PO_DATE" property="poDate"/>
		<result column="PO_MONEY" property="poMoney"/>
		<result column="RE_NAME" property="reName"/>
		<result column="F_NAME" property="fName"/>
		<result column="F_TEL" property="fTel"/>
		<result column="F_ADDR" property="fAddr"/>
		<result column="PB_CONTENT" property="pbContent"/>
		<result column="PO_NUM" property="poNum"/>
	</resultMap>
	
	<!-- 결제 취소 출력 -->
	<select id="payBackList" resultType="PayBackVO">
		SELECT PB_NUM,PRJ_TITLE,USER_NAME,TO_CHAR(PO_DATE,'YYYY-MM-DD') AS "PO_DATE"
    	,PO_MONEY,RE_NAME,F_NAME,F_TEL,F_ADDR,PB_CONTENT
		FROM VIEW_ALL6
		WHERE PB_NUM IS NOT NULL
		GROUP BY PB_NUM,PRJ_TITLE,USER_NAME,PO_DATE
     	,PO_MONEY,RE_NAME,F_NAME,F_TEL,F_ADDR,PB_CONTENT
		ORDER BY PO_DATE DESC, PB_NUM DESC
	</select>
	
	<!-- 관리자 메인> 결제취소현황 -->
	 <select id="payBackCount" resultType="java.lang.Integer">
	 	SELECT count(*)
		FROM TBL_PAY_BACK
	 </select>
	
	<!-- 후원한페이지에서 결제취소 -->
	<update id="canclePay">
	   UPDATE TBL_PAY_OK
	   SET PO_STA ='N', PO_DATE = SYSDATE
	   WHERE  PO_NUM=#{poNum}
	</update>

</mapper>