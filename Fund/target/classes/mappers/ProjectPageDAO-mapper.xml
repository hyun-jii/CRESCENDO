<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.crescendo.spring.user.model.dao.projectpage.IProjectPageDAO">

	<!--  반드시 select문이 있을 경우 명시해줘야한다. -->
	<!--  데이터 겹침 방지 (다른곳에서 사용할때 )  -->
	<!--  type은 VO명 id아무거나  -->
	<!--  property = vo안에 속성이름 -->
	<!--  resultMap type은 config.xml파일에서 설정해준 값 사용 -->
	<resultMap type="ProjectPageVO" id="projectPageResultSet">
		<id column="USER_NUM" property="userNum"/>
		<result column="USER_NAME" property=" userName"/>
		<result column="USER_EMAIL" property="userEmail"/>
		<result column="F_NUM" property="fNum"/>
		<result column="RE_NUM" property="reNum"/>
		<result column="F_NAME" property="fName"/>
		<result column="F_ADDR" property="fAddr"/>
		<result column="F_TEL" property="fTel"/>
		<result column="F_INQUIRE" property="fInquire"/>
		<result column="F_COUNT" property="fCount"/>
		<result column="PR_NUM" property="prNum"/>
		<result column="PR_CARD" property="prCard"/>
		<result column="PR_BIRTH" property="prBirth"/>
		<result column="PR_PW" property="prPw"/>
		<result column="PR_EXPIRE" property="prExpire"/>
		<result column="PR_DATE" property="prDate"/>
		<result column="PR_KEY" property="prKey"/>
		<result column="PO_NUM" property="poNum"/>
		<result column="PO_DATE" property="poDate"/>
		<result column="PO_STA" property="poSta"/>
		<result column="PO_MONEY" property="poMoney"/>
		<result column="CA_NUM" property="caNum"/>
		<result column="CA_NAME" property="caName"/>
		<result column="PRJ_NUM" property="prjNum"/>
		<result column="PRJ_TITLE" property="prjTitle"/>
		<result column="PRJ_SNAME" property="prjSname"/>
		<result column="PRJ_GOAL" property="prjGoal"/>
		<result column="PRJ_IMG" property="prjImg"/>
		<result column="PRJ_TAG" property="prjTag"/>
		<result column="PRJ_CONTENT" property="prjContent"/>
		<result column="RE_NAME" property="reName"/>
		<result column="RE_CONTENT" property="reContent"/>
		<result column="RE_MONEY" property="reMoney"/>
		<result column="RE_LIMIT" property="reLimit"/>
		<result column="MA_NUM" property="maNum"/>
		<result column="MA_NAME" property="maName"/>
		<result column="MA_INFO" property="maInfo"/>
		<result column="MA_PERIOD" property="maPeriod"/>
		<result column="MA_PREDICT" property="maPredict"/>
		<result column="FINAL_NUM" property="finalNum"/>
		<result column="FINAL_STA" property="finalSta"/>
		<result column="FINAL_DATE" property="finalDate"/>
		<result column="PRO_NUM" property="proNum"/>
		<result column="PRO_STA" property="proSta"/>
		<result column="PRO_SHIP" property="proShip"/>
		<result column="PRO_FINISH" property="proFinish"/>
		<result column="REMAIN_DAY" property="remainDay"/>
		<result column="FINAL_DAY" property="finalDay"/>
		<result column="PERCENT" property="percent"/>
		<result column="TOTAL_MONEY" property="totalMoney"/>
		<result column="SUPPORTER" property="supporter"/>
	</resultMap>
	
	<!-- 전체 프로젝트 수 -->
	<select id="totalCount" resultType="java.lang.Integer">
		SELECT COUNT(DISTINCT(PRO_NUM))
		FROM VIEW_ALL6
		WHERE FINAL_STA = '승인'
	</select>
	
	<!-- 카테고리별 프로젝트 수 조회 (전체프로젝트) -->
	<select id="totalPrjCount" resultType="java.lang.Integer">
		SELECT COUNT(DISTINCT(PRO_NUM))
		FROM VIEW_ALL6
		WHERE FINAL_STA = '승인' AND CA_NUM = #{caNum}
	</select>
	
	<!-- 카테고리별 프로젝트 수 조회 (진행중인 프로젝트) -->
	<select id="ingPrjCount" resultType="java.lang.Integer">
		SELECT COUNT(DISTINCT(PRO_NUM))
		FROM VIEW_ALL6
		WHERE FINAL_STA = '승인' AND CA_NUM = #{caNum} AND PRO_STA = '진행중'
	</select>
	
	<!-- 카테고리별 프로젝트 수 조회 (마감한 프로젝트) -->
	<select id="endPrjCount" resultType="java.lang.Integer">
		SELECT COUNT(DISTINCT(PRO_NUM))
		FROM VIEW_ALL6
		WHERE FINAL_STA = '승인' AND CA_NUM = #{caNum} AND PRO_STA IN ('성공','실패')
	</select>
	
	<!-- 카테고리별 프로젝트 (전체프로젝트 - 인기순)  -->
	<select id="totalList_popular" resultType="ProjectPageVO">
		SELECT PRJ_TITLE, PRJ_IMG, MA_NAME, REMAIN_DAY, PERCENT, TOTAL_MONEY, SUPPORTER,PRO_NUM, USER_NUM, PRO_STA
		FROM VIEW_ALL6
		WHERE FINAL_STA = '승인' AND CA_NUM = #{caNum}
		GROUP BY PRO_NUM, PRJ_TITLE, PRJ_IMG, MA_NAME, REMAIN_DAY, PERCENT, TOTAL_MONEY, SUPPORTER, USER_NUM, PRO_STA
		ORDER BY REMAIN_DAY DESC, SUPPORTER
	</select>
	
	<!-- 카테고리별 프로젝트 (전체프로젝트 - 최신순) -->
	<select id="totalList_new" resultType="ProjectPageVO">
		SELECT PRJ_TITLE, PRJ_IMG, MA_NAME, REMAIN_DAY, PERCENT, TOTAL_MONEY, SUPPORTER, USER_NUM,FINAL_DATE, PRO_NUM, PRO_STA
		FROM VIEW_ALL6
		WHERE FINAL_STA = '승인' AND CA_NUM = #{caNum}
		GROUP BY PRO_NUM, PRJ_TITLE, PRJ_IMG, MA_NAME, REMAIN_DAY, PERCENT, TOTAL_MONEY, SUPPORTER,FINAL_DATE, USER_NUM, PRO_STA
		ORDER BY FINAL_DATE DESC, REMAIN_DAY DESC
	</select>
	
	<!-- 카테고리별 프로젝트 (전체프로젝트 - 마감임박순) -->
	<select id="totalList_deadline" resultType="ProjectPageVO">
		SELECT PRJ_TITLE, PRJ_IMG, MA_NAME, REMAIN_DAY, PERCENT, TOTAL_MONEY, SUPPORTER, PRO_STA, USER_NUM, PRO_NUM
		FROM VIEW_ALL6
		WHERE FINAL_STA = '승인' AND CA_NUM = #{caNum}
		GROUP BY PRO_NUM, PRJ_TITLE, PRJ_IMG, MA_NAME, REMAIN_DAY, PERCENT, TOTAL_MONEY, SUPPORTER, PRO_STA, USER_NUM
		ORDER BY PRO_STA DESC, REMAIN_DAY
	</select>
	
	<!-- 카테고리별 프로젝트 (진행중인프로젝트 - 인기순) -->
	<select id="ingList_popular" resultType="ProjectPageVO">
		SELECT PRJ_TITLE, PRJ_IMG, MA_NAME, REMAIN_DAY, PERCENT, TOTAL_MONEY, SUPPORTER, PRO_STA, USER_NUM, PRO_NUM
		FROM VIEW_ALL6
		WHERE FINAL_STA = '승인' AND CA_NUM = #{caNum} AND PRO_STA = '진행중'
		GROUP BY PRO_NUM, PRJ_TITLE, PRJ_IMG, MA_NAME, REMAIN_DAY, PERCENT, TOTAL_MONEY, SUPPORTER, PRO_STA, USER_NUM
		ORDER BY PERCENT DESC, SUPPORTER
	</select>
	
	<!-- 카테고리별 프로젝트 (진행중인프로젝트 - 최신순) -->
	<select id="ingList_new" resultType="ProjectPageVO">
		SELECT PRJ_TITLE, PRJ_IMG, MA_NAME, REMAIN_DAY, PERCENT, TOTAL_MONEY, SUPPORTER, PRO_STA, FINAL_DATE, USER_NUM, PRO_NUM
		FROM VIEW_ALL6
		WHERE FINAL_STA = '승인' AND CA_NUM = #{caNum} AND PRO_STA = '진행중'
		GROUP BY PRO_NUM, PRJ_TITLE, PRJ_IMG, MA_NAME, REMAIN_DAY, PERCENT, TOTAL_MONEY, SUPPORTER, PRO_STA, FINAL_DATE, USER_NUM
		ORDER BY FINAL_DATE DESC, REMAIN_DAY DESC
	</select>
	
	<!-- 카테고리별 프로젝트 (진행중인프로젝트 - 마감임박순) -->
	<select id="ingList_deadline" resultType="ProjectPageVO">
	 	SELECT PRJ_TITLE, PRJ_IMG, MA_NAME, REMAIN_DAY, PERCENT, TOTAL_MONEY, SUPPORTER, PRO_STA, FINAL_DATE, USER_NUM, PRO_NUM
		FROM VIEW_ALL6
		WHERE FINAL_STA = '승인' AND CA_NUM = #{caNum} AND PRO_STA = '진행중'
		GROUP BY PRO_NUM, PRJ_TITLE, PRJ_IMG, MA_NAME, REMAIN_DAY, PERCENT, TOTAL_MONEY, SUPPORTER, PRO_STA, FINAL_DATE, USER_NUM
		ORDER BY PRO_STA DESC, REMAIN_DAY
	</select>
	
	<!-- 카테고리별 프로젝트 (마감한프로젝트) -->
	<select id="endList" resultType="ProjectPageVO">
		SELECT PRJ_TITLE, PRJ_IMG, MA_NAME, REMAIN_DAY, PERCENT, TOTAL_MONEY, SUPPORTER, PRO_STA, FINAL_DATE, USER_NUM, PRO_NUM
		FROM VIEW_ALL6
		WHERE FINAL_STA = '승인' AND CA_NUM = #{caNum} AND PRO_STA IN ('성공', '실패')
		GROUP BY PRO_NUM, PRJ_TITLE, PRJ_IMG, MA_NAME, REMAIN_DAY, PERCENT, TOTAL_MONEY, SUPPORTER, PRO_STA, FINAL_DATE, USER_NUM
		ORDER BY PRO_STA, REMAIN_DAY DESC
	</select>
	
	<!-- 메인 프로젝트 (인기순) -->
	<select id="mainList_popular" resultType="ProjectPageVO">
		SELECT PRJ_TITLE, PRJ_IMG, MA_NAME, REMAIN_DAY, PERCENT, TOTAL_MONEY, NVL(SUPPORTER,0), PRO_STA, FINAL_DATE, PRO_NUM, USER_NUM
		FROM
		(
		SELECT PRJ_TITLE, PRJ_IMG, MA_NAME, REMAIN_DAY, PERCENT, TOTAL_MONEY, SUPPORTER, PRO_STA, FINAL_DATE, PRO_NUM, USER_NUM
		FROM VIEW_ALL6
		WHERE PRO_STA = '진행중' AND NVL(SUPPORTER,0) &gt;= 0
		GROUP BY PRO_NUM, PRJ_TITLE, PRJ_IMG, MA_NAME, REMAIN_DAY, PERCENT, TOTAL_MONEY, SUPPORTER, PRO_STA, FINAL_DATE, USER_NUM
		ORDER BY NVL(SUPPORTER,0) DESC, PERCENT DESC
		)
		WHERE ROWNUM &lt;= 6
	</select>
	
	<!-- 메인 프로젝트 (마감임박순) -->
	<select id="mainList_deadline" resultType="ProjectPageVO">
		SELECT PRJ_TITLE, PRJ_IMG, MA_NAME, REMAIN_DAY, PERCENT, TOTAL_MONEY, NVL(SUPPORTER,0), PRO_STA, FINAL_DATE, PRO_NUM, USER_NUM
		FROM
		(
		SELECT PRJ_TITLE, PRJ_IMG, MA_NAME, REMAIN_DAY, PERCENT, TOTAL_MONEY, SUPPORTER, PRO_STA, FINAL_DATE, PRO_NUM, USER_NUM
		FROM VIEW_ALL6
		WHERE PRO_STA = '진행중' AND NVL(SUPPORTER,0) &gt;= 0
		GROUP BY PRO_NUM, PRJ_TITLE, PRJ_IMG, MA_NAME, REMAIN_DAY, PERCENT, TOTAL_MONEY, SUPPORTER, PRO_STA, FINAL_DATE, USER_NUM
		ORDER BY REMAIN_DAY, NVL(SUPPORTER,0) DESC, PERCENT DESC
		)
		WHERE ROWNUM &lt;= 6
	</select>
	
	<!-- 메인 프로젝트 (최신순) -->
	<select id="mainList_new" resultType="ProjectPageVO">
		SELECT PRJ_TITLE, PRJ_IMG, MA_NAME, REMAIN_DAY, PERCENT, TOTAL_MONEY,NVL(SUPPORTER,0), PRO_STA, FINAL_DATE, PRO_NUM, USER_NUM
		FROM
		(
		SELECT PRJ_TITLE, PRJ_IMG, MA_NAME, REMAIN_DAY, PERCENT, TOTAL_MONEY,SUPPORTER, PRO_STA, FINAL_DATE, PRO_NUM, USER_NUM
		FROM VIEW_ALL6
		WHERE PRO_STA = '진행중' AND NVL(SUPPORTER,0) &gt;= 0
		GROUP BY PRO_NUM, PRJ_TITLE, PRJ_IMG, MA_NAME, REMAIN_DAY, PERCENT, TOTAL_MONEY,SUPPORTER, PRO_STA, FINAL_DATE, USER_NUM
		ORDER BY FINAL_DATE DESC
		)
		WHERE ROWNUM &lt;= 6
	</select>
	
	
	<!-- 전체 프로젝트(진행, 성공, 실패) -->
	<select id="totalList" resultType="ProjectPageVO">
		SELECT PRJ_TITLE, PRJ_IMG, MA_NAME, REMAIN_DAY, PERCENT, TOTAL_MONEY, SUPPORTER,PRO_NUM, USER_NUM
		FROM VIEW_ALL6
		WHERE FINAL_STA = '승인'
		GROUP BY PRO_NUM, PRJ_TITLE, PRJ_IMG, MA_NAME, REMAIN_DAY, PERCENT, TOTAL_MONEY, SUPPORTER, USER_NUM
		ORDER BY REMAIN_DAY DESC, SUPPORTER
	</select>
	
	<!-- 프로젝트별 남은일자, 마감, 상태 리스트 -->
	<select id="projectList" resultType="ProjectPageVO">
		SELECT PRO_NUM, REMAIN_DAY, PRO_STA, PERCENT, PRO_SHIP
		FROM VIEW_ALL6
		WHERE PRO_NUM IS NOT NULL
		GROUP BY PRO_NUM, REMAIN_DAY, PRO_STA, PERCENT, PRO_SHIP
	</select>
	

   
   
</mapper>